{# templates/partials/_navbar.html.twig #}
{# -- Calcul des pourcentages pour les barres -- #}
{% set balance = (app.user and app.user.wallet) ? app.user.wallet.balance : 0 %}


{% set pending = (app.user and app.user.wallet and app.user.wallet.pendingAmount is defined) 
    ? app.user.wallet.pendingAmount 
    : 0 %}

{% set total = balance + pending %}
{% set pctAvailable = total > 0 ? (balance * 100 / total) : 0 %}
{% set pctPending   = total > 0 ? (pending * 100 / total) : 0 %}
{% set pctAvailable = pctAvailable|round(0, 'floor') %}
{% set pctPending   = 100 - pctAvailable %}


<nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm">

	<div
		class="container">


		{# Brand #}
		<a class="navbar-brand d-flex align-items-center" href="{{ path('app_home') }}">
			<img src="{{ asset('asset/images/logo.svg') }}" alt="Logo EcoRide" height="32" class="me-2">
		</a>

		{# Toggler #}
		<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar" aria-controls="mainNavbar" aria-expanded="false" aria-label="Afficher le menu">
			<span class="navbar-toggler-icon"></span>
		</button>

		<div
			class="collapse navbar-collapse" id="mainNavbar">
			{# Left nav #}
			<ul class="navbar-nav me-auto">
				<li class="nav-item">
<a class="nav-link fw-semibold" href={{ path('app_how_it_works') }}>




						Comment ça marche ?
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link fw-semibold" href="#">
						Covoiturages
					</a>
				</li>
				<li class="nav-item">
<a class="nav-link fw-semibold" href="{{ path('app_contact') }}">

						Contact
					</a>
				</li>
			</ul>

			{# Right side: actions #}
			<ul
				class="navbar-nav ms-auto align-items-lg-center">

				{# Bouton Publier un trajet (hors dropdown) #}
				<li class="nav-item ms-md-2">
				
<a href="{{ path('app_login') }}" class="fw-semibold rounded-pill d-flex align-items-center">


							<i class="bi bi-plus-circle me-2"></i>
							Publier un trajet
						</a>
				</li>

				{# Wallet (si connecté) #}
				{% if app.user %}
					<li class="nav-item dropdown ms-md-2">
						<a class="nav-link dropdown-toggle d-flex align-items-center fw-semibold" href="#" id="navWallet" role="button" data-bs-toggle="dropdown" aria-expanded="false">
							<i class="bi bi-wallet2 me-1"></i>
							<span class="d-none d-lg-inline">Wallet</span>
<span class="badge bg-success ms-2">
	{% if app.user %}
		{% set balance = (app.user and app.user.wallet) ? app.user.wallet.balance : 0 %}
		{{ balance }}
	{% endif %}


</span>


							<span class="badge bg-warning text-dark ms-1">
								<i class="bi bi-lock-fill me-1"></i>
{% if app.user %}
	{% set walletTransaction = (app.user and app.user.wallet.walletTransaction is defined) ? app.user.wallet.walletTransaction.amount : 0 %}
	{{walletTransaction}}


{% endif %}


							</span>
						</a>
						<div class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="navWallet" style="min-width: 320px;">
							<div class="p-3">
								<div class="d-flex justify-content-between align-items-center mb-2">
									<div class="text-muted small">Solde disponible</div>
<div class="fw-bold text-success">
	{% if app.user %}
		{% set balance = (app.user and app.user.wallet) ? app.user.wallet.balance : 0 %}
		{{ balance }}
	{% endif %}
</div>


								</div>
								<div class="d-flex justify-content-between align-items-center">
									<div class="text-muted small">Solde en attente</div>
<div class="fw-bold text-warning">
	{% if app.user %}
		{% set walletTransaction = (app.user and app.user.wallet.walletTransaction is defined) ? app.user.wallet.walletTransaction.amount : 0 %}

		{{walletTransaction}}

	{% endif %}
</div>


								</div>
								<div class="mt-3">
									<div class="progress" style="height: 6px;">
<div class="progress-bar bg-success" role="progressbar" style="width: {{ pctAvailable }}%" aria-valuenow="{{ pctAvailable }}" aria-valuemin="0" aria-valuemax="100"></div>
<div class="progress-bar bg-warning" role="progressbar" style="width: {{ pctPending }}%" aria-valuenow="{{ pctPending }}" aria-valuemin="0" aria-valuemax="100"></div>


									</div>
									<div class="d-flex justify-content-between small text-muted mt-1">
										<span>Disponible</span>
										<span>En attente</span>
									</div>
								</div>
							</div>
						</div>
					</li>
				{% endif %}

				{# Compte #}
				<li class="nav-item dropdown ms-md-2">
					{% if app.user %}
						{% set pseudo  = app.user.pseudo ?? (app.user.email|split('@')[0]) %}
						{% set initial = (pseudo|slice(0,1)|upper) %}
						{% set isDriver = 'ROLE_DRIVER' in app.user.roles %}
						{% set modeLabel = isDriver ? 'Conducteur' : 'Passager' %}
						{% set modeBadge = isDriver ? 'success' : 'primary' %}

						<a class="nav-link dropdown-toggle d-flex align-items-center fw-semibold" href="#" id="navAccount" role="button" data-bs-toggle="dropdown" aria-expanded="false">
							<span class="rounded-circle d-inline-flex align-items-center justify-content-center me-2" style="width:28px;height:28px;background:rgba(0,0,0,.08);">
								<strong class="small">{{ initial }}</strong>
							</span>
<span class="d-inline d-lg-inline">{{ pseudo }}</span>

						</a>

						<div class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="navAccount" style="min-width: 260px;">
							<div class="px-3 py-2 small">
								<div class="fw-semibold">{{ pseudo }}</div>
								<div class="text-muted">Mode :
									<span class="badge bg-{{ modeBadge }}">{{ modeLabel }}</span>
								</div>
							</div>
							<div class="dropdown-divider"></div>

<a class="dropdown-item" href="{{path('app_front_profil')}}">


								<i class="bi bi-person-circle me-2"></i>
								Mon profil
							</a>
<a class="dropdown-item" href="{{path('app_driver_preferences_index')}}">


								<i class="bi bi-sliders2 me-2"></i>
								Mes préférences
							</a>

							{% if isDriver %}
<a class="dropdown-item" href="#">


									<i class="bi bi-calendar2-event me-2"></i>
									Mes covoiturages
								</a>
							{% endif %}

							<div class="dropdown-divider"></div>
							<a class="dropdown-item text-danger" href="{{ path('app_logout') }}">
								<i class="bi bi-box-arrow-right me-2"></i>
								Déconnexion
							</a>
						</div>

					{% else %}
						<a class="nav-link dropdown-toggle d-flex align-items-center fw-semibold" href="#" id="navAccount" role="button" data-bs-toggle="dropdown" aria-expanded="false">
							<i class="bi bi-person-circle me-2"></i>
<span class="d-inline d-lg-inline">Mon compte</span>


						</a>
						<div class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="navAccount">
							<a class="dropdown-item" href="{{ path('app_login') }}">
								<i class="bi bi-box-arrow-in-right me-2"></i>
								Connexion
							</a>
							<a class="dropdown-item" href="{{ path('app_register') }}">
								<i class="bi bi-person-plus me-2"></i>
								Créer un compte
							</a>
						</div>
					{% endif %}
				</li>
			</ul>
		</div>
	</div>


</nav>


{% if app.user and (app.user.isVerified is defined) and not app.user.isVerified %}
	<div class="alert alert-warning text-center m-0 rounded-0 border-0 py-2 small">
		<strong>Votre adresse e-mail n’est pas encore vérifiée.</strong>
		Vérifiez votre boîte de réception (et vos spams).
	</div>
{% endif %}





