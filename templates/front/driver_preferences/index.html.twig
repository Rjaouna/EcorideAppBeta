{% extends 'base.html.twig' %}

{% block title %}DriverPreferences index
{% endblock %}

{% block body %}
	{# calcul des rôles actuels #}
	{% set hasDriver = is_granted('ROLE_DRIVER') %}
	{% set hasPassenger = is_granted('ROLE_PASSENGER') %}

	<div class="container mt-4">
		<h5>
			{% if hasDriver and hasPassenger %}


				Passager et Conducteur
			{% elseif hasDriver %}
				Conducteur
			{% elseif hasPassenger %}
				Passager
			{% else %}
				Passager


			{% endif %}
		</h5>


		<a href="{{ path('app_front_profil') }}" class="btn btn-link mt-3">

			← Retour à mon profil
		</a>


		<div class="card border-0 shadow-sm rounded-3 mb-4">


			<div class="card-body">
				<div class="d-flex justify-content-between align-items-center mb-3">
					<div>
						<small class="text-muted">Choisissez comment vous utilisez EcoRide</small>
						{% if statusButton %}


							<div class="alert alert-info mb-0 p-2" role="alert">{{  message|raw }}</div>
						{% endif %}


					</div>


				</div>

				<form method="post" action="{{ path('app_front_driver_preferences_switch_mode') }}">

					<div
						class="btn-group" role="group" aria-label="Choix du rôle">
						{# Passager #}
						<input type="radio" class="btn-check" name="roleChoice" id="rolePassenger" value="passenger" {% if hasPassenger and not hasDriver %} checked {% endif %}>
						<label class="btn btn-outline-primary" for="rolePassenger">Passager</label>

						{# Conducteur #}
						<input type="radio" class="btn-check" name="roleChoice" id="roleDriver" value="driver" {% if hasDriver and not hasPassenger %} checked {% endif %}>
						<label class="btn btn-outline-primary {{statusButton}}" for="roleDriver">Conducteur</label>


						{# Les deux #}
						<input type="radio" class="btn-check" name="roleChoice" id="roleBoth" value="both" {% if (hasDriver and hasPassenger) or (not hasDriver and not hasPassenger) %} checked {% endif %}>
						<label class="btn btn-outline-primary {{statusButton}}" for="roleBoth">Les deux</label>

					</div>

					<input type="hidden" name="_token" value="{{ csrf_token('switch_role') }}">

					<div class="mt-3 d-flex gap-2">
						<button type="submit" class="btn btn-secondary text-light btn-sm">Mettre à jour</button>

						<span class="align-self-center text-muted small">
							Rôle actuel&nbsp;:
							<span class="badge bg-light text-dark border">
								{% if hasDriver and hasPassenger %}
									Passager et Conducteur

								{% elseif hasDriver %}
									Conducteur
								{% elseif hasPassenger %}
									Passager
								{% else %}
									—
								{% endif %}
							</span>
						</span>
					</div>
				</form>
			</div>
		</div>

	</div>
	{% if hasDriver %}
		{{ include('front/driver_preferences/_composants/_preferencesUser.html.twig') }}
		{{ include('front/driver_preferences/_composants/_list_vehicles.html.twig') }}

	{% endif %}


{% endblock %}

